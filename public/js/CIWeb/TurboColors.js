!function(a){var b={Convolution:function(a,b,c,d,e,f){void 0!=d&&null!=d||(d=1),void 0!=e&&null!=e||(e=0);var g=new Uint8ClampedArray(a.length);if("BIN"!=f){f="RGB";var h={x:Math.floor((b.width-1)/2),y:Math.floor((b.height-1)/2),index:0};h.index=Math.floor(h.x+h.y*b.width);for(var i=0,j=a.length;i<j;i+=4){var k={y:Math.floor(i/(4*c)),x:0},l={r:0,g:0,b:0};k.x=Math.round(i/4-k.y*c);for(var m=0;m<b.height;m++)for(var n=0;n<b.width;n++){var o=n-h.x,p=m-h.y,q=k.x-o,r=k.y-p,s=Math.round(n+m*b.width),t=4*(q+r*c);a[t]&&(l.r+=b.bin[s]*a[t],l.g+=b.bin[s]*a[t+1],l.b+=b.bin[s]*a[t+2])}g[i]=d*l.r+e,g[i+1]=d*l.g+e,g[i+2]=d*l.b+e,g[i+3]=a[i+3]}}else{var h={x:Math.floor((b.width-1)/2),y:Math.floor((b.height-1)/2),index:0};h.index=Math.floor(h.x+h.y*b.width);for(var i=0,j=a.length;i<j;i++){var k={y:Math.floor(i/c),x:0},l=0;k.x=Math.floor(i-k.y*c);for(var m=0;m<b.height;m++)for(var n=0;n<b.width;n++){var o=n-h.x,p=m-h.y,q=k.x-o,r=k.y-p,s=n+m*b.width,t=q+r*c;a[t]&&(l+=b.bin[s]*a[t])}g[i]=Math.round(d*l+e)}}return g},RGB:{parseToHSV:function(a,b,c){var d={h:0,s:0,v:0},e=Math.max(a,b,c),f=Math.min(a,b,c);return e!=f&&(e==a&&b>=c?d.h=60*((b-c)/(e-f)):e==a&&b<c?d.h=60*((b-c)/(e-f))+360:e==b?d.h=60*((b-c)/(e-f))+120:e==c&&(d.h=60*((b-c)/(e-f))+240)),0!=e&&(d.s=1-f/e),d.v=(a+b+c)/3,d},parseToHSL:function(a,b,c){var d=Math.max(a,b,c),e=Math.min(a,b,c),f={h:0,s:0,l:0};return d!=e&&(d==a&&b>=c?f.h=60*((b-c)/(d-e))+0:d==a&&b<c?f.h=60*((b-c)/(d-e))+360:d==b?f.h=60*((b-c)/(d-e))+120:d==c&&(f.h=60*((b-c)/(d-e))+240)),f.l=(d+e)/2,d!=e&&(f.l<=.5?f.s=(d-e)/(2*f.l):f.s=Math.abs((d-e)/(2-2*f.l))),f},parseToNormalized:function(a,b,c){var d=a+b+c,e={Rn:a/d,Gn:b/d,Bn:c/d};return e},parseToYCrCb:function(a,b,c){var d={y:Math.round(.257*a+.504*b+.098*c+16),Cr:Math.round(-(.148*a)-.291*b+.439*c+128),Cb:Math.round(.439*a-.368*b-.071*c+128)};return d},parseToTLS:function(a,c,d){var e={t:0,l:0,s:0},f=b.RGB.parseToNormalized(a,c,d),g=f.Rn-1/3,h=f.Gn-1/3,i=f.Bn-1/3;return h>0?e.t=Math.atan(g/h)/(2*Math.PI)+.25:h<0&&(e.t=Math.atan(g/h)/(2*Math.PI)+.75),e.s=Math.sqrt(1.8*(Math.pow(g,2)+Math.pow(h,2))),e.l=.299*g+.587*h+.114*i,e},parseToLux:function(a,b,c){var d={l:Math.pow(a+1,.3)*Math.pow(b+1,.5)*Math.pow(c+1,.1),u:0};return a<d.l?d.u=128*((a+1)/(d.l+1)):d.u=256+128*((d.l+1)/(c+1)),d.u},isHuman:function(a,b,c){return a>95&&b>40&&b<100&&c>20&&Math.max(a,b,c)-Math.min(a,b,c)>15&&Math.abs(a-b)>15&&a>b&&a>c},whitePatch:function(a){for(var b=new Uint8ClampedArray(a.length),c={r:0,g:0,b:0},d=0,e=a.length;d<e&&(c.r=Math.max(c.r,a[d]),c.g=Math.max(c.g,a[d+1]),c.b=Math.max(c.b,a[d+2]),!(255==c.r&&255==c.g&255==c.b));d+=4);for(var d=0,e=a.length;d<e;d+=4)b[d]=a[d]*Math.round(255/c.r),b[d+1]=a[d+1]*Math.round(255/c.g),b[d+2]=a[d+2]*Math.round(255/c.b);return b},Effects:{Filters:{BLUR:{width:5,height:5,bin:[.003,.0133,.0219,.0133,.003,.0133,.0596,.0983,.0596,.0133,.0219,.0983,.1621,.0983,.0219,.0133,.0596,.0983,.0596,.0133,.003,.0133,.0219,.0133,.003]},GAUSSIAN:{width:5,height:5,bin:[.003663003663003663,.014652014652014652,.02564102564102564,.014652014652014652,.003663003663003663,.014652014652014652,.05860805860805861,.09523809523809523,.05860805860805861,.014652014652014652,.02564102564102564,.09523809523809523,.15018315018315018,.09523809523809523,.02564102564102564,.014652014652014652,.05860805860805861,.09523809523809523,.05860805860805861,.014652014652014652,.003663003663003663,.014652014652014652,.02564102564102564,.014652014652014652,.003663003663003663]},MEDIA:{width:3,height:3,bin:[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111]},LAGAUSSIANO:{width:5,height:5,bin:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,16,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0]},PREWITTV:{width:3,height:3,bin:[-1,-1,-1,0,0,0,1,1,1]},PREWITTH:{width:3,height:3,bin:[-1,0,-1,-1,0,1,-1,0,1]},SOBELV:{width:3,height:3,bin:[-1,-2,-1,0,0,0,1,2,1]},SOBELH:{width:3,height:3,bin:[-1,0,1,-2,0,2,-1,0,1]},LAPLACIANO:{width:3,height:3,bin:[0,-1,0,-1,4,-1,0,-1,0]},SHARPEN:{width:5,height:5,bin:[0,0,0,0,0,0,0,-1,0,0,0,-1,5,-1,0,0,0,-1,0,0,0,0,0,0,0]},EMBOSS:{width:3,height:3,bin:[-2,-1,0,-1,1,1,0,1,2]}},Color:{GrayScale:function(a,b,c){return Math.round((a+b+c)/3)},BlackAlpha:function(a,b,c,d){return(d<2||d>10||void 0==d)&&(d=5),{r:a/d,g:b/d,b:c/d}},HightContrast:function(a,b,c,d){return void 0==d&&(d=60),{r:(a-128)*Math.tan(d*Math.PI/180)+128,g:(b-128)*Math.tan(d*Math.PI/180)+128,b:(c-128)*Math.tan(d*Math.PI/180)+128}}},Layer:{Overlap:function(a,b){return Math.floor(a/255*(a+2*b/255*(255-a)))},Screen:function(a,b){return Math.floor(255-(255-b)*(255-a)/255)},Whiten:function(a,b){return Math.floor(256*a/(256-b))},Blacken:function(a,b){return Math.floor(255-(256*(255-a)/b+1))},Subtraction:function(a,b){return Math.abs(a-b)}}}},HSV:{parseToRGB:function(a,b,c){var d=Math.round(Math.abs(a/60)%6),e=a/60%6-d,f=c*(1-b),g=c*(1-b*e),h=c*(1-(1-e)*b),i={r:0,g:0,b:0};switch(d){case 0:i.r=c,i.g=h,i.b=f;break;case 1:i.r=g,i.g=c,i.b=f;break;case 2:i.r=f,i.g=c,i.b=h;break;case 3:i.r=f,i.g=g,i.b=c;break;case 4:i.r=h,i.g=f,i.b=c;break;case 5:i.r=c,i.g=f,i.b=g}return i.r=Math.round(i.r),i.g=Math.round(i.g),i.b=Math.round(i.b),i},parseToRGBNormalized:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToNormalized(e.r,e.g,e.b)},parseToHSL:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToHSL(e.r,e.g,e.b)},parseToYCrCb:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToYCrCb(e.r,e.g,e.b)},parseToTLS:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToTLS(e.r,e.g,e.b)},parseToLux:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToLux(e.r,e.g,e.b)},isHuman:function(a,b,c){return(a>=0&&a<=50||a>=340&&a<=360)&&b>.12&&b<.68&&c>=102}},RnGnBn:{parseToRGB:function(a,b,c){var d={r:0,g:0,b:0};return d.r=Math.round(255*a),d.g=Math.round(255*b),d.b=Math.round(255*c),d},parseToHSV:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToHSV(e.r,e.g,e.b)},parseToHSL:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToHSL(e.r,e.g,e.b)},parseToYCrCb:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToYCrCb(e.r,e.g,e.b)},parseToTLS:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToTLS(e.r,e.g,e.b)},parseToLux:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToTLS(e.r,e.g,e.b)},isHuman:function(a,b,c){return a/b>1.185&&a*c/Math.pow(c+b+c,2)>.107&&a*b/Math.pow(a+b+c,2)>.112}},HSL:{parseToRGB:function(a,b,c){var d=Math.round(Math.abs(a/60)%6),e=a/60%6-d,f=c*(1-b),g=c*(1-b*e),h=c*(1-(1-e)*b),i={r:0,g:0,b:0};switch(d){case 0:i.r=c,i.g=h,i.b=f;break;case 1:i.r=g,i.g=c,i.b=f;break;case 2:i.r=f,i.g=c,i.b=h;break;case 3:i.r=f,i.g=g,i.b=c;break;case 4:i.r=h,i.g=f,i.b=c;break;case 5:i.r=c,i.g=f,i.b=g}return i.r=Math.round(i.r),i.g=Math.round(i.g),i.b=Math.round(i.b),i},parseToHSV:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToHSV(e.r,e.g,e.b)},parseToNormalized:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToNormalized(e.r,e.g,e.b)},parseToYCrCb:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToYCrCb(e.r,e.g,e.b)},parseToTLS:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToTLS(e.r,e.g,e.b)},parseToLux:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToLux(e.r,e.g,e.b)}},YCrCb:{parseToRGB:function(a,b,c){return{r:Math.round(a+1.402*(b-128)),g:Math.round(a-.34414*(c-128)-.71414*(b-128)),b:Math.round(a+1.772*(c-128))}},parseToHSV:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToHSV(e.r,e.g,e.b)},parseToNormalized:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToNormalized(e.r,e.g,e.b)},parseToHSL:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToHSL(e.r,e.g,e.b)},parseToTLS:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToTLS(e.r,e.g,e.b)},parseToLux:function(a,c,d){var e=this.parseToRGB(a,c,d);return b.RGB.parseToLux(e.r,e.g,e.b)},isHuman:function(a,b){return b>=80&&b<=120&&a>=133&&a<=173}}},c=function(a,c){var d;return"BIN"!=c&&"GRAY"!=c?(d={r:new Float32Array(256),g:new Float32Array(256),b:new Float32Array(256)},d.Calcule=function(){for(var b=0,c=a.length;b<c;b+=4)this.r[a[b]]++,this.g[a[b+1]]++,this.b[a[b+2]]++},d.Normalize=function(){for(var a={r:Math.max.apply(null,this.r),g:Math.max.apply(null,this.g),b:Math.max.apply(null,this.b)},b={r:Math.min.apply(null,this.r),g:Math.min.apply(null,this.g),b:Math.min.apply(null,this.b)},c=0;c<256;c++)d.r[c]=(d.r[c]-b.r)/(a.r-b.r),d.g[c]=(d.g[c]-b.g)/(a.g-b.g),d.b[c]=(d.b[c]-b.b)/(a.b-b.b)},d.Discreet=function(){for(var b={r:new Float32Array(256),g:new Float32Array(256),b:new Float32Array(256)},c={r:new Float32Array(256),g:new Float32Array(256),b:new Float32Array(256)},d=0,e=a.length/4;d<256;d++){b.r[d]=this.r[d]/e,b.g[d]=this.g[d]/e,b.b[d]=this.b[d]/e;for(var f=0;f<=d;f++)c.r[d]+=b.r[f],c.g[d]+=b.g[f],c.b[d]+=b.b[f]}return c},d.Equalize=function(){for(var b=new Uint8ClampedArray(a.length),c=this.Discreet(),d=0,e=b.length;d<e;d+=4)b[d]=Math.round(255*c.r[a[d]]),b[d+1]=Math.round(255*c.g[a[d+1]]),b[d+2]=Math.round(255*c.b[a[d+2]]);return b}):(d=new Float32Array(256),"BIN"==c?d.Calcule=function(){for(var b=0,c=a.length;b<c;b++)this[a[b]]++}:d.Calcule=function(){for(var c=0,d=a.length;c<d;c+=4)this[b.RGB.Effects.Color.GrayScale(a[c],a[c+1],a[c+2])]++},d.Discreet=function(){for(var b=new Float32Array(256),d=new Float32Array(256),e=0,f="BIN"==c?a.length:a.length/4;e<256;e++){b[e]=this[e]/f,b[e]=this[e]/f,b[e]=this[e]/f;for(var g=0;g<=e;g++)d[e]+=b[g],d[e]+=b[g],d[e]+=b[g]}return d},d.Equalize=function(){var d=new Uint8ClampedArray(a.length),e=this.Discreet();if("GRAY"==c)for(var f=0,g=d.length;f<g;f+=4){var h=Math.round(255*e[b.RGB.Effects.Color.GrayScale(a[f],a[f+1],a[f+2])]);d[f]=h,d[f+1]=h,d[f+2]=h}else for(var f=0,g=d.length;f<g;f+=4)d[f]=Math.round(255*e[a[f]]);return d},d.Normalize=function(){for(var a=Math.max.apply(null,this),b=Math.min.apply(null,this),c=0;c<256;c++)d[c]=(d[c]-b)/(a-b)}),d.Functions={inverse:function(a){return 255-a},square:function(a){return Math.pow(a,2)/255},cubic:function(a){return Math.pow(a,3)/65025},sqrt:function(a){return Math.sqrt(255*a)},sqrt3:function(a){return Math.cbrt(65025*a)},log:function(a){return 255*(Math.log(1+a)/Math.log(256))}},Object.defineProperty(d,"Calcule",{enumerable:!1,writable:!1}),Object.defineProperty(d,"Normalize",{enumerable:!1,writable:!1}),Object.defineProperty(d,"Equalize",{enumerable:!1,writable:!1}),Object.defineProperty(d,"Discreet",{enumerable:!1,writable:!1}),Object.defineProperty(d,"Functions",{enumerable:!1,writable:!1}),d.Calcule(),d};a.Histograms=c,a.Colors=b,Object.freeze(a.Colors),Object.freeze(a.Colors.RGB),Object.freeze(a.Colors.RGB.Filters),Object.freeze(a.Colors.RGB.Effects),Object.freeze(a.Colors.RGB.Effects.Color),Object.freeze(a.Colors.RGB.Effects.Layer),Object.freeze(a.Colors.HSV),Object.freeze(a.Colors.RnGnBn),Object.freeze(a.Colors.HSL),Uint8ClampedArray.prototype.Histogram=function(a){return c.apply(null,[this,a])},ImageData.prototype.Convolution=function(a,c,d,e){return b.Convolution.apply(null,[this.data,a,this.width,c,d,e])}}(this);